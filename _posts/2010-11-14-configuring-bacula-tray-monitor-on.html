---
layout: post
title: Configuring Bacula Tray Monitor on Ubuntu
date: '2010-11-14T07:51:00.000-08:00'
author: Larry Reid
tags:
- Backups
- Bacula
modified_time: '2010-11-14T07:51:02.553-08:00'
blogger_id: tag:blogger.com,1999:blog-5778824359157275227.post-8174736114657160985
blogger_orig_url: http://technopragmatica.blogspot.com/2010/11/configuring-bacula-tray-monitor-on.html
---

I use&nbsp;<a href="http://www.bacula.org/">Bacula</a>&nbsp;to back up my servers and desktop/laptop computers.&nbsp;It's always bugged me that I didn't have a little icon on my Ubuntu desktop showing the status of the backup: whether it was running or not and some indication of progress.&nbsp;Most backup systems have this. In Bacula it's called the tray monitor. The <a href="http://bacula.org/5.0.x-manuals/en/main/main/Monitor_Configuration.html#13700">configuration file documentation</a> seemed straightforward, but it took a lot of fiddling to get it right.<br /><br />I think I have a fairly typical situation:<br /><ul><li>A backup server with a direct attached backup storage device (in my case, two: a USB-connected 1 TB hard drive, and a DAT-72 tape drive)</li><li>Several clients being backed up on a regular schedule</li><li>One client is the laptop I use as my normal workstation. This is the one I want to put the tray monitor on</li><li>I'm already successfully backing up this configuration, so all my passwords in my Bacula configuration files are correct, and all my firewalls are configured to allow the backup to work</li><li>The laptop and the backup server are both running Ubuntu 10.04</li></ul>Here's what I did to get the tray monitor to work (read my notes below before you start cutting and pasting the following into your configuration):<br /><ol><li>I installed the tray monitor software on my laptop:</li><pre><code>sudo apt-get install bacula-traymonitor<br /></code></pre><li>On my laptop I changed the tray monitor configuration file (<code>/etc/bacula/tray-monitor.conf</code>) to look like this:</li><pre><code>Monitor {<br />  Name = backup02-mon<br />  Password = "Monitor-Password"<br />  RefreshInterval = 5 seconds<br />}<br /><br />Client {<br />  Name = pacal-mon<br />  Address = pacal.pender.jadesystems.ca<br />  FDPort = 9102<br />  Password = "Monitor-Password"<br />}</code></pre><li>Still on the laptop, I added the following to the file daemon, aka backup client, configuration file (<code>/etc/bacula/bacula-fd.conf</code>):</li><pre><code># Restricted Director, used by tray-monitor to get the<br />#   status of the file daemon<br /><br />Director {<br />  Name = backup02-mon<br />  Password = "Monitor-Password"<br />  Monitor = yes<br />}</code></pre><li>I restarted the file daemon on the laptop (don't forget this or you'll confuse yourself horribly):</li><pre><code>sudo service bacula-fd restart<br /></code></pre><li>On the backup server, I added the following to the director configuration file (<code>/etc/bacula/bacula-dir.conf</code>):</li><pre><div><code># Restricted console used by tray-monitor to get the status of the director</code></div><div><code>Console {</code></div><div><code>&nbsp;&nbsp;Name = backup02-mon</code></div><div><code>&nbsp;&nbsp;Password = "Monitor-Password"</code></div><div><code>&nbsp;&nbsp;CommandACL = status, .status</code></div><div><code>}</code></div></pre><li>Finally, I reloaded the configuration file on the backup server:</li><pre><code>sudo bconsole <br />reload <br />exit <br /></code></pre><div><li>Now all I had to do is start the tray monitor. The command line is:</li><pre><code>bacula-tray-monitor -c /etc/bacula/tray-monitor.conf</code></pre></div></ol>Then I made a menu item for it. I put it in Applications-&gt; System Tools.<br /><ol><li>Select System-&gt; Preferences-&gt; Main Menu</li><li>Select "System Tools" on the left side of the window</li><li>Click on the "New Item" button on the right side of the window</li><li>Fill in the "Name:" box with "Bacula Tray Monitor" and the "Command:" box with the command line above</li><li>Click "OK"</li><li>Click "Close" in the "Main Menu" window</li></ol>Notes:<br /><ul><li>I used a separate password specifically for the monitor. The tray monitor's configuration file has to be readable by an ordinary user without special privileges. So anyone can see the password. Don't use the same password for the monitor as you use for the director or the file daemons, or you'll be making it easy for anyone who gets access to your computer to read all the files on your network.</li><li>You have to change to above bits of configuration file to match your particular configuration. Change: "laptop.example.com" to the fully qualified domain name of the computer on which you're installing the tray monitor. Change "Monitor-Password" to something else more secure that everyone who reads this blog doesn't know about.&nbsp;</li><li>"backup02-mon" and "laptop-mon" are both names you can change to be anything you want them to be. In my case, "backup02-mon" means the monitor on the backup server (hostname: backup02), and "laptop-mon" means the monitor on the laptop (hostname: laptop)</li></ul>