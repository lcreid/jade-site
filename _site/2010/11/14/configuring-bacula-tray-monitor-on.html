<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->

<!-- Latest compiled and minified CSS -->
<!-- Bootstrap -->
<!-- <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous"> -->
<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->

<title>Jade Systems Inc Configuring Bacula Tray Monitor on Ubuntu</title>

<link rel="stylesheet" type="text/css" href="/assets/application-12da5280a458727aaeb8688175d798b537281705752dd2bdc70cc4e5d9c5a0c0.css">
<script src="/assets/application-da8cbe894a308e89b1a3507e6010f3ac382cbf2d7b8ae2cdc365edd2b1a50ea9.js" type="text/javascript"></script>
<!-- TODO: Remove the following line as see what happens -->
<link href="https://code.jquery.com/ui/1.11.2/themes/smoothness/jquery-ui.css" rel="stylesheet">
<link href='//fonts.googleapis.com/css?family=Droid+Sans:400,700|Signika+Negative:400,700' rel='stylesheet' type='text/css'>
<link rel="icon" href="/favicon.ico" type="image/x-icon">
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">

<!-- you don't need to keep this, but it's cool for stats! -->
<meta name="generator" content="jekyll">

  </head>
  <body>
    <div class="container-fluid">
  <nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top">
    <a class="navbar-brand" href="/">Jade Systems Inc</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse">
      <ul class="navbar-nav w-100 mx-md-4">
        <li class="nav-item dropdown">
          <a href="#" class="nav-item dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Knowledgebase</span></a>
          <div class="dropdown-menu">
            <a class="dropdown-item" href="/knowledgebase.html">Overview</a>
            <a class="dropdown-item" href="/knowledgebase/static-web-sites.html">Static Web Sites</a>
            <a class="dropdown-item" href="/knowledgebase/search-engines.html">Search Engines</a>
          </div>
        </li>
        <li><a class="nav-item mx-md-4" href="/contact.html">Contact Us</a></li>
      </ul>

      <!-- <form class="form-inline ml-auto">
        <div class="form-group">
          <input type="text" placeholder="Search" class="form-control" id="search" name="query" value="" autocomplete="off" />
        </div>
        <button type="button" class="btn btn-success" id="search-button">Search</button>
      </form> -->
    </div>
  </nav>
</div>

<div class="container">
  <div id="search-results">
    <div id="clear-results" class="clear-button" style="display: block;">&nbsp;</div>
    <ul id="search-results-list"></ul>
    <div id="pagination-outer-container">
      <div id="pagination-inner-container" class="text-center mx-auto">
        <div id="pagination"></div>
      </div>
    </div>
  </div>
</div>

    <section class="mt-2">
      <div class="container">
        <div class="row justify-content-around">
          <div class="col-12 col-lg-8">
            <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Configuring Bacula Tray Monitor on Ubuntu</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2010-11-14T15:51:00+00:00" itemprop="datePublished">Nov 14, 2010
      </time>â€¢ <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">Larry Reid</span></span></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    I use&nbsp;<a href="http://www.bacula.org/">Bacula</a>&nbsp;to back up my servers and desktop/laptop computers.&nbsp;It's always bugged me that I didn't have a little icon on my Ubuntu desktop showing the status of the backup: whether it was running or not and some indication of progress.&nbsp;Most backup systems have this. In Bacula it's called the tray monitor. The <a href="http://bacula.org/5.0.x-manuals/en/main/main/Monitor_Configuration.html#13700">configuration file documentation</a> seemed straightforward, but it took a lot of fiddling to get it right.<br /><br />I think I have a fairly typical situation:<br /><ul><li>A backup server with a direct attached backup storage device (in my case, two: a USB-connected 1 TB hard drive, and a DAT-72 tape drive)</li><li>Several clients being backed up on a regular schedule</li><li>One client is the laptop I use as my normal workstation. This is the one I want to put the tray monitor on</li><li>I'm already successfully backing up this configuration, so all my passwords in my Bacula configuration files are correct, and all my firewalls are configured to allow the backup to work</li><li>The laptop and the backup server are both running Ubuntu 10.04</li></ul>Here's what I did to get the tray monitor to work (read my notes below before you start cutting and pasting the following into your configuration):<br /><ol><li>I installed the tray monitor software on my laptop:</li><pre><code>sudo apt-get install bacula-traymonitor<br /></code></pre><li>On my laptop I changed the tray monitor configuration file (<code>/etc/bacula/tray-monitor.conf</code>) to look like this:</li><pre><code>Monitor {<br />  Name = backup02-mon<br />  Password = "Monitor-Password"<br />  RefreshInterval = 5 seconds<br />}<br /><br />Client {<br />  Name = pacal-mon<br />  Address = pacal.pender.jadesystems.ca<br />  FDPort = 9102<br />  Password = "Monitor-Password"<br />}</code></pre><li>Still on the laptop, I added the following to the file daemon, aka backup client, configuration file (<code>/etc/bacula/bacula-fd.conf</code>):</li><pre><code># Restricted Director, used by tray-monitor to get the<br />#   status of the file daemon<br /><br />Director {<br />  Name = backup02-mon<br />  Password = "Monitor-Password"<br />  Monitor = yes<br />}</code></pre><li>I restarted the file daemon on the laptop (don't forget this or you'll confuse yourself horribly):</li><pre><code>sudo service bacula-fd restart<br /></code></pre><li>On the backup server, I added the following to the director configuration file (<code>/etc/bacula/bacula-dir.conf</code>):</li><pre><div><code># Restricted console used by tray-monitor to get the status of the director</code></div><div><code>Console {</code></div><div><code>&nbsp;&nbsp;Name = backup02-mon</code></div><div><code>&nbsp;&nbsp;Password = "Monitor-Password"</code></div><div><code>&nbsp;&nbsp;CommandACL = status, .status</code></div><div><code>}</code></div></pre><li>Finally, I reloaded the configuration file on the backup server:</li><pre><code>sudo bconsole <br />reload <br />exit <br /></code></pre><div><li>Now all I had to do is start the tray monitor. The command line is:</li><pre><code>bacula-tray-monitor -c /etc/bacula/tray-monitor.conf</code></pre></div></ol>Then I made a menu item for it. I put it in Applications-&gt; System Tools.<br /><ol><li>Select System-&gt; Preferences-&gt; Main Menu</li><li>Select "System Tools" on the left side of the window</li><li>Click on the "New Item" button on the right side of the window</li><li>Fill in the "Name:" box with "Bacula Tray Monitor" and the "Command:" box with the command line above</li><li>Click "OK"</li><li>Click "Close" in the "Main Menu" window</li></ol>Notes:<br /><ul><li>I used a separate password specifically for the monitor. The tray monitor's configuration file has to be readable by an ordinary user without special privileges. So anyone can see the password. Don't use the same password for the monitor as you use for the director or the file daemons, or you'll be making it easy for anyone who gets access to your computer to read all the files on your network.</li><li>You have to change to above bits of configuration file to match your particular configuration. Change: "laptop.example.com" to the fully qualified domain name of the computer on which you're installing the tray monitor. Change "Monitor-Password" to something else more secure that everyone who reads this blog doesn't know about.&nbsp;</li><li>"backup02-mon" and "laptop-mon" are both names you can change to be anything you want them to be. In my case, "backup02-mon" means the monitor on the backup server (hostname: backup02), and "laptop-mon" means the monitor on the laptop (hostname: laptop)</li></ul>
  </div><a class="u-url" href="/2010/11/14/configuring-bacula-tray-monitor-on.html" hidden></a>
</article>

          </div>
        </div>
      </div>
    </section>
    <div class="fixed-bottom bg-white">
  <hr>
  <footer class="text-center mb-2">
    This site was built by Jade Systems Inc using
    <a href="https://jekyllrb.com">Jekyll</a>.
    Layout and styling by <a href="https://getbootstrap.com">Bootstrap</a>.
    <!-- Search by <%= link_to("Solr", "http://lucene.apache.org/solr", target: "_blank") %>.
    Crawl by <%= link_to("Nutch", "http://nutch.apache.org/", target: "_blank") %>. -->
  </footer>

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-1728165-2', 'jadesystems.ca');
    ga('send', 'pageview');
  </script>

  <script type="text/javascript" src="/js/jquery.simplePagination.js"></script>
  <script src="/js/jadesystems_namespace.js"></script>
  <script src="/js/dev.js"></script>
  <script src="/js/search.js"></script>
</div>

  </body>
</html>
