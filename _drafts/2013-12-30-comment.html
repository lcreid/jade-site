---
layout: post
title: Ruby DBus Notes
date: '2013-12-30T12:52:00.002-08:00'
author: Larry Reid
tags: 
modified_time: '2013-12-30T12:52:53.229-08:00'
blogger_id: tag:blogger.com,1999:blog-5778824359157275227.post-4081941153523734047
blogger_orig_url: https://www.blogger.com/comment.g?blogID=5778824359157275227&postID=4081941153523734047
---

<a href="http://en.wikipedia.org/wiki/D-Bus" target="_blank">DBus</a> is a message handling protocol for inter-process communication. It's part of the <a href="http://freedesktop.org/" target="_blank">FreeDesktop</a> project, meaning it's supported on most major Linux distros. I wanted to use it as a perhaps better way to deal with a screen capturing application I was writing that should only have one instance running at a time (per user). I also wanted to be able to pause and restart the screen capture with a combination of key presses, even when another application was in the foreground.<br /><br />The first thing I did was read <a href="http://packages.python.org/txdbus/dbus_overview.html">http://packages.python.org/txdbus/dbus_overview.html</a>, <a href="http://www.freedesktop.org/wiki/IntroductionToDBus/">http://www.freedesktop.org/wiki/IntroductionToDBus/</a>, and <a href="http://dbus.freedesktop.org/doc/dbus-tutorial.html">http://dbus.freedesktop.org/doc/dbus-tutorial.html</a>. There's a lot of overlap, but it was good to get the message two times. Then I read <a href="https://github.com/mvidner/ruby-dbus/blob/master/doc/Tutorial.md">https://github.com/mvidner/ruby-dbus/blob/master/doc/Tutorial.md</a> for the Ruby take on it.<br /><br /><br />In DBus terms, what I wanted was a service on the session bus (because my application is a user application), and a message to that service.<br /><br />Gotchas:<br /><ul><li>For some of DBus to work, you need a process running that's  providing the service, and sometimes you need an object exported. This would  be the application or daemon</li><li>There is a significant difference between the process that creates  the service and processes that simply connect to the service. DBus  definitely works on a client-server model. I can't find it in the Ruby bindings. (When you get an object on the service owner, it comes back as the actual object type, not a DBus::ProxyObject.)</li><li>A signal goes from the server to any clients that happen to be listening. You can't make the server listen for a signal. That doesn't really matter, because a client can call a method on the server and ignore the return value</li><li>A  method call goes from one of the clients to the server. If you don't  care about the return value, you can do anything with a method call that  you can do with a signal</li></ul><br /><br />I discovered two commands that would have been very useful: dbus-monitor and dbus-send.<br /><br />dbus-monitor watches what's happening on the service and interface and outputs it to the terminal window, so you can leave it running in one window and see when messages are being put on the bus. dbus-monitor only shows the message when the service is running, i.e. there is a process that has created the service.<br /><br />dbus-send sends messages or signals to whatever destination you want.<br /><br />gem install ruby-dbus<br /><br />The server:<br /><br />The client: